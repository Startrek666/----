define(["jquery"], function ($) { "use strict"; function init() { try { var aiCheckEnabled = $("#id_assignsubmission_ai_check_enabled"); if (aiCheckEnabled.length === 0) { return } var fileEnabled = $("#id_assignsubmission_file_enabled"); var maxFiles = $("#id_assignsubmission_file_maxfiles"); var fileTypes = $("#id_assignsubmission_file_filetypes"); function enforceFileRestrictions() { try { if (aiCheckEnabled.val() == "1") { if (fileEnabled.length) { fileEnabled.val("1").prop("disabled", true) } if (maxFiles.length) { maxFiles.val("1").prop("disabled", true) } if (fileTypes.length) { fileTypes.val("pdf,docx").prop("disabled", true) } fileEnabled.closest(".form-group").addClass("ai-check-forced"); maxFiles.closest(".form-group").addClass("ai-check-forced"); fileTypes.closest(".form-group").addClass("ai-check-forced"); if (!$(".ai-check-notice").length && fileTypes.length) { $('<div class="alert alert-info ai-check-notice mt-2"><strong>注意：</strong>启用AI批改时，文件提交设置将被自动配置为：最多1个文件，仅支持PDF和DOCX格式。</div>').insertAfter(fileTypes.closest(".form-group")) } } else { fileEnabled.prop("disabled", false); maxFiles.prop("disabled", false); fileTypes.prop("disabled", false); fileEnabled.closest(".form-group").removeClass("ai-check-forced"); maxFiles.closest(".form-group").removeClass("ai-check-forced"); fileTypes.closest(".form-group").removeClass("ai-check-forced"); $(".ai-check-notice").remove() } } catch (e) { console.log("AI Check: Error in enforceFileRestrictions", e) } } enforceFileRestrictions(); aiCheckEnabled.on("change", function () { enforceFileRestrictions() }); if (!$("#ai-check-custom-css").length) { $('<style id="ai-check-custom-css">.ai-check-forced { opacity: 0.7; }.ai-check-forced input, .ai-check-forced select { background-color: #f8f9fa !important; }</style>').appendTo("head") } $(document).on("submit", "form", function (e) { try { if (aiCheckEnabled.val() == "1") { var standardAnswer = $("#id_assignsubmission_ai_check_standard_answer").val(); var gradingRubric = $("#id_assignsubmission_ai_check_grading_rubric").val(); if (standardAnswer && standardAnswer.trim() === "") { e.preventDefault(); alert("错误：启用AI批改时，参考答案/关键要点不能为空。"); return false } if (gradingRubric && gradingRubric.trim() === "") { e.preventDefault(); alert("错误：启用AI批改时，评分标准/建议不能为空。"); return false } } } catch (e) { console.log("AI Check: Error in form validation", e) } }) } catch (e) { console.log("AI Check: Error in init", e) } } return { init: init } }); 